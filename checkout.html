<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <meta name="description" content="Select your Meterbolic test and complete your purchase for comprehensive metabolic health insights." />
    <title>Checkout - Meterbolic Metabolic Health Testing</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;700&family=Lexend:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Load checkout.css FIRST to avoid conflicts -->
    <link rel="stylesheet" href="css/checkout.css">
    <link rel="stylesheet" href="css/navbar-footer.css">
    <link rel="stylesheet" href="css/navbar-footer-responsive.css">
    <!-- Remove index.css as it's not needed for checkout and may cause conflicts -->

    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
</head>
<body>

<!-- Checkout Main Section -->
<main class="checkout-main">
  <div class="checkout-container">
    <!-- Left Column - Dynamic Content -->
    <div class="checkout-left">
      <!-- Step 1: Product Selection -->
      <div class="checkout-step active" id="step1">
        <h1 class="checkout-title">Select your test</h1>
        
        <div class="products-grid">
          <div class="product-card" data-product="baseline">
            <h3>Baseline</h3>
            <p class="product-desc">The health check everyone should do.</p>
            <div class="product-price">£89</div>
          </div>
          
          <div class="product-card" data-product="response">
            <h3>Meterbolic Response</h3>
            <p class="product-desc">The full picture of how your body handles food.</p>
            <div class="product-price">£179</div>
          </div>
        </div>
        
        <div class="checkout-buttons">
          <button class="btn-back" id="backBtnStep1">Back</button>
          <button class="btn-next" id="nextBtnStep1" disabled>Next</button>
        </div>
      </div>

      <!-- Step 2: Blood Collection Method for Baseline -->
      <div class="checkout-step" id="step2-baseline">
        <h1 class="checkout-title">Select your blood collection method</h1>
        
        <div class="products-grid">
          <div class="product-card blood-collection" data-method="finger-prick" data-price="0">
            <h3>Finger prick</h3>
            <div class="blood-collection-icon">
              <img src="images/finger-prick.png" alt="Finger Prick Device" class="collection-image">
            </div>
            <div class="product-price">£0</div>
          </div>
          
          <div class="product-card blood-collection" data-method="tasso" data-price="20">
            <h3>Tasso</h3>
            <div class="blood-collection-icon">
              <img src="images/tasso.png" alt="Tasso Device" class="collection-image">
            </div>
            <div class="product-price">£20</div>
          </div>
        </div>
        
        <div class="checkout-buttons">
          <button class="btn-back" id="backToStep1Baseline">Back</button>
          <button class="btn-next" id="nextBtnStep2Baseline" disabled>Next</button>
        </div>
      </div>

      <!-- Step 2: Blood Collection Method for Response -->
      <div class="checkout-step" id="step2-response">
        <h1 class="checkout-title">Select your blood collection method</h1>
        
        <div class="products-grid">
          <div class="product-card blood-collection" data-method="finger-prick" data-price="0">
            <h3>Finger prick</h3>
            <div class="blood-collection-icon">
              <img src="images/finger-prick.png" alt="Finger Prick Device" class="collection-image">
            </div>
            <div class="product-price">£0</div>
          </div>
          
          <div class="product-card blood-collection" data-method="tasso" data-price="60">
            <h3>Tasso</h3>
            <div class="blood-collection-icon">
              <img src="images/tasso.png" alt="Tasso Device" class="collection-image">
            </div>
            <div class="product-price">£60</div>
          </div>
        </div>
        
        <div class="checkout-buttons">
          <button class="btn-back" id="backToStep1Response">Back</button>
          <button class="btn-next" id="nextBtnStep2Response" disabled>Next</button>
        </div>
      </div>

      <!-- Step 3: Delivery Details Form -->
      <div class="checkout-step checkout-step-3" id="step3-delivery">
        <!-- Logo in top left for Step 3 only -->
        <div class="logo-top-left">
          <img src="images/logo-checkout.png" alt="Meterbolic Logo">
        </div>
        
        <h1 class="checkout-title-step3">PLEASE ENTER THE DELIVERY DETAILS</h1>
        
        <div class="delivery-form-container">
          <!-- Honey Pot Field (hidden from humans) -->
          <div style="display: none;" aria-hidden="true">
            <input type="text" id="honeypot" name="honeypot" tabindex="-1" autocomplete="off">
          </div>
          
          <form class="delivery-form" id="checkoutForm" action="send-checkout.php" method="POST">
            <div class="form-section">
              <h3 class="section-title">Personal Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName" class="form-label">First Name <span class="required">*</span></label>
                  <input type="text" id="firstName" name="firstName" class="form-input" placeholder="Enter your first name" required>
                </div>
                <div class="form-group">
                  <label for="lastName" class="form-label">Last Name <span class="required">*</span></label>
                  <input type="text" id="lastName" name="lastName" class="form-input" placeholder="Enter your last name" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="email" class="form-label">Email Address <span class="required">*</span></label>
                  <input type="email" id="email" name="email" class="form-input" placeholder="your.email@example.com" required>
                </div>
                <div class="form-group phone-group">
                  <label for="phone" class="form-label">Phone Number <span class="required">*</span></label>
                  <div class="phone-input-container">
                    <div class="phone-prefix">+44</div>
                    <input type="tel" id="phone" name="phone" class="form-input phone-input" placeholder="Enter your phone number" required>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-section">
              <h3 class="section-title">Delivery Address</h3>
              <div class="form-group">
                <label class="form-label">Country/Region</label>
                <div class="form-input region-display">United Kingdom</div>
                <input type="hidden" name="country" value="United Kingdom">
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="postcode" class="form-label">Postcode <span class="required">*</span></label>
                  <input type="text" id="postcode" name="postcode" class="form-input" placeholder="e.g., SW1A 1AA" required>
                </div>
                <div class="form-group">
                  <label for="town" class="form-label">Town/City <span class="required">*</span></label>
                  <input type="text" id="town" name="town" class="form-input" placeholder="Enter your town or city" required>
                </div>
              </div>
              
              <div class="form-group">
                <label for="address" class="form-label">Street Address <span class="required">*</span></label>
                <input type="text" id="address" name="address" class="form-input" placeholder="Enter your street address" required>
              </div>
              
              <div class="form-group">
                <label for="houseNumber" class="form-label">House Number/Name <span class="required">*</span></label>
                <input type="text" id="houseNumber" name="houseNumber" class="form-input" placeholder="e.g., 123 or Rose Cottage" required>
              </div>
            </div>
            
            <div class="form-section">
              <h3 class="section-title">Preferences</h3>
              <div class="checkbox-group">
                <input type="checkbox" id="marketing" name="marketing" class="checkbox" value="1">
                <label for="marketing" class="checkbox-label">
                  I want to receive personalised commercial communications from Meterbolic by email.
                </label>
              </div>
              
              <div class="checkbox-group">
                <input type="checkbox" id="privacy" name="privacy" class="checkbox" required>
                <label for="privacy" class="checkbox-label">
                  I have read and understand the Privacy and Cookies Policy.
                </label>
              </div>
            </div>
            
            <!-- Hidden fields to store product selection -->
            <input type="hidden" id="formSelectedProduct" name="selectedProduct" value="">
            <input type="hidden" id="formSelectedMethod" name="selectedMethod" value="">
            <input type="hidden" id="formMethodPrice" name="methodPrice" value="">
            <input type="hidden" id="formProductPrice" name="productPrice" value="">
            <input type="hidden" id="formTotalAmount" name="totalAmount" value="">
          </form>
          
          <div class="checkout-buttons-step3">
            <button class="btn-back-step3" id="backToStep2">Back</button>
            <button type="submit" form="checkoutForm" class="btn-next-step3" id="submitBtnStep3">Check out with Stripe</button>
          </div>
        </div>
      </div>
      
      <!-- Logo in bottom left (for Steps 1 & 2 only) -->
      <div class="logo-bottom-left">
        <img src="images/logo.png" alt="Meterbolic Logo">
      </div>
    </div>
    
    <!-- Right Column - Order Summary -->
    <div class="checkout-right">
      <div class="order-summary">
        <img src="images/mailbox-leaf.png" alt="Meterbolic Test Kit" class="product-image">
        <div class="order-details">
          <h3>Your Selection</h3>
          <div id="selectedProductDisplay" class="selected-info">
            <p>Please select a test</p>
          </div>
          <div id="selectedMethodDisplay" class="selected-method">
            <div class="method-selected">
              <h4>Collection Method</h4>
              <p id="methodName"></p>
              <div class="price" id="methodPriceDisplay"></div>
            </div>
          </div>
          <div id="totalPriceDisplay" class="total-price">
            <div class="total-selected">
              <h4>Total</h4>
              <div class="price" id="totalAmountDisplay"></div>
            </div>
          </div>
          <div class="delivery-notice">
            *a Delivery fee of £8.50 will be applied on checkout.
          </div>
          <div class="stripe-notice" style="display: none;">
            <p>Check out with Stripe</p>
            <div class="terms-notice">
              By continuing, I declare that I have read and accept the Purchase Conditions and understand Meterbolic's Privacy and Cookie Policy.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="js/navbar.js"></script>
<script src="js/checkout.js"></script>
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
<script type="module" src="js/auth0-config.js"></script>
<script type="module" src="js/auth0-service.js"></script>
<script type="module" src="js/auth0-handler.js"></script>
</body>
</html>